---
# ByteFreezer Proxy - Ansible Playbook
# Deploy proxy to edge locations

- name: Deploy ByteFreezer Proxy
  hosts: proxy
  become: true
  vars_files:
    - vars/main.yml
    - vars/secrets.yml

  pre_tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
        cache_valid_time: 3600
      when: ansible_os_family == "Debian"

  roles:
    - role: docker
      when: install_docker | default(true)
    - role: proxy

  post_tasks:
    - name: Display service status
      debug:
        msg: |
          ByteFreezer Proxy deployed successfully!

          API: http://{{ ansible_host }}:8008
          UDP Ports: {{ udp_ports | join(', ') }}
