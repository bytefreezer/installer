[Unit]
Description=Prometheus Monitoring
After=docker.service
Requires=docker.service

[Service]
Type=simple
Restart=always
RestartSec=5

ExecStartPre=-/usr/bin/docker stop bytefreezer-prometheus
ExecStartPre=-/usr/bin/docker rm bytefreezer-prometheus

ExecStart=/usr/bin/docker run --rm \
  --name bytefreezer-prometheus \
  --network host \
  -v {{ bytefreezer_config_dir }}/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro \
  -v {{ prometheus_data_dir }}:/prometheus \
  prom/prometheus:v2.48.0 \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.path=/prometheus \
  --storage.tsdb.retention.time={{ prometheus_retention }} \
  --web.enable-lifecycle

ExecStop=/usr/bin/docker stop bytefreezer-prometheus

[Install]
WantedBy=multi-user.target
